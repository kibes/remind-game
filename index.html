<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REMIND</title>
    <style>
        /* –°–±—Ä–æ—Å —Å—Ç–∏–ª–µ–π –∏ –±–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω –∏ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ */
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #db4e4e; /* –ö—Ä–∞—Å–Ω—ã–π —Ñ–æ–Ω */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 10px;
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–≥—Ä—ã - –ê–î–ê–ü–¢–ò–í–ù–´–ô */
        .game-container {
            width: 100%;
            max-width: 100%;
            background: white; /* –ë–µ–ª—ã–π —Ñ–æ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            height: calc(100vh - 20px); /* –ù–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω —Å –æ—Ç—Å—Ç—É–ø–∞–º–∏ */
            margin: auto;
            position: relative;
            overflow: hidden;
            max-width: 800px;
            max-height: 800px;
        }

        /* –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∏ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .header { text-align: center; margin-bottom: 10px; flex-shrink: 0; }
        h1 { font-size: 32px; color: #db4e4e; font-weight: 300; letter-spacing: 1px; }
        .stats { display: flex; justify-content: center; gap: 25px; margin-top: 10px; }
        .stat-label { font-size: 12px; color: #db4e4e; text-transform: uppercase; }
        .stat-value { font-size: 24px; font-weight: bold; color: #333; transition: 0.3s; }
        .stat-value.updating { transform: scale(1.2); color: #db4e4e; } /* –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–Ω–∞—á–µ–Ω–∏—è */

        /* –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å */
        .game-content {
            flex: 1; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—ë –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 1;
            visibility: visible;
            transition: opacity 0.4s ease 0s, visibility 0.4s ease 0s; /* –ò—Å—á–µ–∑–∞–µ—Ç –ø–µ—Ä–≤—ã–º */
            min-height: 0; /* –í–∞–∂–Ω–æ –¥–ª—è flex-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
        }
        .game-content.hidden { 
            opacity: 0; 
            pointer-events: none; 
            visibility: hidden; 
            transition: opacity 0.4s ease 0s, visibility 0.4s ease 0s; 
        }

        /* –û–±–ª–∞—Å—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ */
        .character-display {
            width: 100%;
            max-width: 380px;
            flex: 1; /* –ó–∞–Ω–∏–º–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
            min-height: 200px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            max-height: 480px;
            position: relative;
            border: 2px solid #db4e4e;
            border-radius: 10px;
            background: #fff;
            overflow: hidden;
            margin-top: 5px;
        }

        @media (max-height: 500px) {
            .character-display {
                max-height: 250px;
            }
        }

        .character-layer {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background-size: contain; background-repeat: no-repeat; background-position: center bottom;
        }

        /* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–µ–∫—Ü–∏—è (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∏ —Ç–∞–π–º–µ—Ä) */
        .info-section {
            height: 80px; /* –£–º–µ–Ω—å—à–µ–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            width: 100%;
            flex-shrink: 0; /* –ù–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
        }
        .instruction { 
            font-size: 22px; /* –£–í–ï–õ–ò–ß–ï–ù–ù–´–ô —Ä–∞–∑–º–µ—Ä */
            color: #db4e4e; 
            font-weight: bold; 
            opacity: 0; 
            transform: translateY(10px);
            transition: 0.4s all; 
            min-height: 26px;
        }
        .instruction.show { opacity: 1; transform: translateY(0); }
        
        /* –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Ç–∞–π–º–µ—Ä –±–µ–∑ –∞–Ω–∏–º–∞—Ü–∏–∏ */
        .timer { 
            font-size: 100px;
            font-weight: bold; 
            color: #db4e4e; 
            opacity: 0; 
            transition: opacity 0.3s ease;
            position: absolute;
            bottom: 20px;
            z-index: 5;
        }
        .timer.show { 
            opacity: 1; 
        }

        /* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–∫–Ω–æ–ø–∫–∏) */
        .controls-container {
            height: 70px; /* –£–º–µ–Ω—å—à–µ–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            z-index: 10;
            flex-shrink: 0; /* –ù–µ —Å–∂–∏–º–∞–µ—Ç—Å—è */
            margin-top: auto; /* –ü—Ä–∏–∂–∏–º–∞–µ—Ç—Å—è –∫ –Ω–∏–∑—É */
        }
        .btn {
            background: #db4e4e;
            color: white;
            border: none;
            padding: 18px 35px; /* –ë–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
            font-size: 17px; /* –ù–æ—Ä–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease; /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –∫–Ω–æ–ø–æ–∫ */
            margin-bottom: 20px; /* –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π –æ—Ç—Å—Ç—É–ø */
            opacity: 1;
            transform: scale(1);
            width: auto;
            white-space: nowrap; /* –¢–µ–∫—Å—Ç –Ω–µ –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—Å—è */
        }
        
        .btn:hover { background: #c93c3c; transform: translateY(-2px) scale(1); }
        .btn:active { transform: translateY(0) scale(1); }
        .btn.hidden { 
            display: none; 
            opacity: 0;
            transform: scale(0.8);
        }
        .btn.show { 
            display: block; 
            animation: buttonAppear 0.2s ease forwards;
        }
        
        @keyframes buttonAppear {
            0% {
                opacity: 0;
                transform: scale(0.8);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
        .result-screen {
            position: absolute;
            top: 120px; /* –£–º–µ–Ω—å—à–µ–Ω–Ω—ã–π –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É */
            left: 0; 
            right: 0; 
            bottom: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease 0s, visibility 0.4s ease 0s; /* –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π –ø–æ—Å–ª–µ —Å–∫—Ä—ã—Ç–∏—è –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ */
            padding: 0 10px 10px 10px; /* –û—Ç—Å—Ç—É–ø—ã –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö */
            justify-content: flex-start; /* –ù–∞—á–∏–Ω–∞–µ–º —Å –≤–µ—Ä—Ö–∞ */
        }
        .result-screen.show { 
            opacity: 1; 
            visibility: visible; 
            z-index: 20; 
        }

        .comparison-container {
            display: flex;
            gap: 15px;
            margin-top: 10px;
            flex-wrap: wrap;
            justify-content: center;
            width: 100%;
        }
        
        .result-character {
            width: 100%;
            max-width: 500px;
            min-width: 300px;
            flex: 1; /* –ó–∞–Ω–∏–º–∞–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ */
            min-height: 430px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ */
            max-height: 480px;
            position: relative;
            border: 2px solid #db4e4e;
            border-radius: 10px;
            background: #fff;
            margin-top: 5px;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ */
        @media (max-width: 700px) {
            .comparison-container {
                flex-direction: column;
                align-items: center;
            }
            
            .result-character {
                min-height: 170px;
                max-height: 480px;
            }
        }


        .result-percent {
            font-size: 52px;
            font-weight: bold;
            color: #db4e4e;
            margin-bottom: 10px;
        }
        
        .result-text { 
            font-size: 20px;
            font-weight: bold; 
            color: #db4e4e; 
            margin-bottom: 25px;
            text-align: center;
        }
        
        .comparison-label { 
            text-transform: lowercase; 
            font-size: 14px; 
            color: #db4e4e; 
            text-align: center; 
            margin-top: 5px; 
        }
        
        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–Ω–æ–ø–∫–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö */
        .result-screen .controls-container {
            margin-top: 15px;
            padding-bottom: 10px;
            flex-shrink: 0;
        }
        
        /* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö */
        @media (max-height: 700px) {
            .result-screen {
                overflow-y: auto; /* –î–æ–±–∞–≤–ª—è–µ–º —Å–∫—Ä–æ–ª–ª –µ—Å–ª–∏ –Ω–µ –ø–æ–º–µ—â–∞–µ—Ç—Å—è */
            }
            
            .result-screen::-webkit-scrollbar {
                width: 4px;
            }
            
            .result-screen::-webkit-scrollbar-track {
                background: #f1f1f1;
                border-radius: 10px;
            }
            
            .result-screen::-webkit-scrollbar-thumb {
                background: #db4e4e;
                border-radius: 10px;
            }

        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="header">
            <h1>REMIND</h1>
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">–ò–≥—Ä–∞</div>
                    <div class="stat-value" id="round">1</div>
                </div>
                <div class="stat">
                    <div class="stat-label">–ú–∞–∫—Å. —Å–µ—Ä–∏—è</div>
                    <div class="stat-value" id="max-streak">0</div>
                </div>
                <div class="stat">
                    <div class="stat-label">–°–µ—Ä–∏—è –ø–æ–±–µ–¥</div>
                    <div class="stat-value" id="streak">0</div>
                </div>
            </div>
        </div>

        <!-- –ò–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å -->
        <div class="game-content" id="game-area">
            <div class="character-display" id="character-display"></div>
            <div class="info-section">
                <div class="instruction" id="instruction">–ù–∞—á–Ω—ë–º?</div>
                <div class="timer" id="timer"></div>
            </div>
            <div class="controls-container">
                <button class="btn" id="start-btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
                <button class="btn hidden" id="select-btn">–í—ã–±—Ä–∞—Ç—å</button>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ -->
        <div class="result-screen" id="result-screen">
            <div class="comparison-container">
                <div class="comparison-item">
                    <div class="result-character" id="result-target"></div>
                    <div class="comparison-label">–æ–∂–∏–¥–∞–Ω–∏–µ</div>
                </div>
                <div class="comparison-item">
                    <div class="result-character" id="result-player"></div>
                    <div class="comparison-label">—Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å</div>
                </div>
            </div>
            <div class="result-percent" id="result-percent">0%</div>
            <div class="result-text" id="result-text" style="margin-top:0"></div>
            <div class="controls-container" style="margin-top: auto; padding-bottom: 10px;">
                <button class="btn" id="result-again-btn">–ï—â—ë —Ä–∞–∑</button>
            </div>
        </div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏–≥—Ä—ã
        const state = {
            round: 1,               // –¢–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥
            maxStreak: 0,           // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–µ—Ä–∏—è –ø–æ–±–µ–¥
            streak: 0,              // –¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è –ø–æ–±–µ–¥
            target: {},             // –¶–µ–ª–µ–≤–æ–π –ø–µ—Ä—Å–æ–Ω–∞–∂ (–∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å)
            selection: {},          // –í—ã–±–æ—Ä –∏–≥—Ä–æ–∫–∞
            parts: ['skin', 'head', 'body', 'accessory'], // –ß–∞—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            partCounts: { skin: 4, head: 7, body: 8, accessory: 7 }, // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏
            loaded: {},             // –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            order: {},              // –†–∞–Ω–¥–æ–º–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–π —á–∞—Å—Ç–∏ –≤ —Ç–µ–∫—É—â–µ–π –∏–≥—Ä–µ
            interval: null,         // –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è —Ü–∏–∫–ª–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–±–æ—Ä–∞ —á–∞—Å—Ç–µ–π
            idleInterval: null,     // –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ —Ä–µ–∂–∏–º–µ –æ–∂–∏–¥–∞–Ω–∏—è
            currentPart: 0,         // –¢–µ–∫—É—â–∞—è —á–∞—Å—Ç—å –ø—Ä–∏ –≤—ã–±–æ—Ä–µ
            canSelect: true,        // –§–ª–∞–≥ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–∞
            idleCharacter: {},      // –ü–µ—Ä—Å–æ–Ω–∞–∂ –≤ —Ä–µ–∂–∏–º–µ –æ–∂–∏–¥–∞–Ω–∏—è
            lastResult: null,       // –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∏–≥—Ä—ã: 'win', 'lose', –∏–ª–∏ null –¥–ª—è –ø–µ—Ä–≤–æ–π –∏–≥—Ä—ã
            isBusy: false,          // –§–ª–∞–≥ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π –≤–æ –≤—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–π
            isTimerActive: false,   // –§–ª–∞–≥ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Ç–∞–π–º–µ—Ä–∞
            gamePhase: 'idle',      // –¢–µ–∫—É—â–∞—è —Ñ–∞–∑–∞ –∏–≥—Ä—ã: 'idle', 'creating', 'memorizing', 'selecting', 'finished'
            fastCycle: null,        // –ò–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –±—ã—Å—Ç—Ä–æ–π —Å–º–µ–Ω—ã —á–∞—Å—Ç–µ–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            startBtnLock: false,    // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"
            resetBtnLock: false     // –ù–û–í–´–ô –§–õ–ê–ì: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ï—â—ë —Ä–∞–∑"
        };

        // –°—Å—ã–ª–∫–∏ –Ω–∞ DOM —ç–ª–µ–º–µ–Ω—Ç—ã
        const elements = {
            round: document.getElementById('round'),
            maxStreak: document.getElementById('max-streak'),
            streak: document.getElementById('streak'),
            timer: document.getElementById('timer'),
            instruction: document.getElementById('instruction'),
            characterDisplay: document.getElementById('character-display'),
            startBtn: document.getElementById('start-btn'),
            selectBtn: document.getElementById('select-btn'),
            resultAgainBtn: document.getElementById('result-again-btn'),
            gameArea: document.getElementById('game-area'),
            resultScreen: document.getElementById('result-screen'),
            resultPercent: document.getElementById('result-percent'),
            resultText: document.getElementById('result-text'),
            resultTarget: document.getElementById('result-target'),
            resultPlayer: document.getElementById('result-player')
        };

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ —ç–ª–µ–º–µ–Ω—Ç–æ–≤
        function createRandomOrder() {
            state.order = {};
            state.parts.forEach(type => {
                // –°–æ–∑–¥–∞–µ–º –º–∞—Å—Å–∏–≤ —á–∏—Å–µ–ª –æ—Ç 0 –¥–æ partCounts[type]-1
                const indices = Array.from({length: state.partCounts[type]}, (_, i) => i);
                // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –º–∞—Å—Å–∏–≤
                for (let i = indices.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [indices[i], indices[j]] = [indices[j], indices[i]];
                }
                state.order[type] = indices;
            });
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É –≤ —Ä–∞–Ω–¥–æ–º–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
        function getRandomOrderItem(type, index) {
            const realIndex = state.order[type][index % state.order[type].length];
            return state.loaded[type][realIndex];
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–∞—Å—Ç–µ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        async function loadImages() {
            const folders = { skin: 'skins/', head: 'heads/', body: 'bodies/', accessory: 'accessories/' };
            for (const type of state.parts) {
                state.loaded[type] = [];
                for (let i = 1; i <= state.partCounts[type]; i++) {
                    const img = new Image();
                    img.src = `${folders[type]}${i}.png`;
                    await new Promise(r => { 
                        img.onload = r; 
                        img.onerror = () => { r(); }; // –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –¥–∞–∂–µ –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–æ—Å—å
                    });
                    state.loaded[type].push({ id: i, img: img });
                }
            }
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ
        function render(container, data) {
            container.innerHTML = '';
            state.parts.forEach(p => {
                if (data[p]) {
                    const div = document.createElement('div');
                    div.className = 'character-layer';
                    div.style.backgroundImage = `url('${data[p].img.src}')`;
                    container.appendChild(div);
                }
            });
        }

        // –ó–∞–ø—É—Å–∫ –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ —Ä–µ–∂–∏–º–µ –æ–∂–∏–¥–∞–Ω–∏—è (–¥–æ –Ω–∞—á–∞–ª–∞ –∏–≥—Ä—ã)
        function startIdle() {
            state.gamePhase = 'idle';
            state.startBtnLock = false; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
            state.resetBtnLock = false; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É "–ï—â—ë —Ä–∞–∑"
            createRandomOrder(); // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —Ä–∞–Ω–¥–æ–º–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –¥–ª—è –Ω–æ–≤–æ–π –∏–≥—Ä—ã
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –∏–≥—Ä—ã
            let instructionText;
            if (state.lastResult === null) {
                instructionText = "–ù–∞—á–Ω—ë–º?";
            } else if (state.lastResult === 'win') {
                instructionText = "–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—ã—Å–∏–ª–∞—Å—å!";
            } else if (state.lastResult === 'almost') {
                instructionText = "–°–µ–π—á–∞—Å –ø–æ–ª—É—á–∏—Ç—Å—è!";
            } else { // 'lose'
                instructionText = "–ù–∞—á–Ω—ë–º —Å–Ω–∞—á–∞–ª–∞?";
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –Ω–∞–¥–ø–∏—Å—å
            elements.instruction.textContent = instructionText;
            elements.instruction.classList.add('show');
            
            state.parts.forEach(p => {
                const randomIndex = Math.floor(Math.random() * state.partCounts[p]);
                state.idleCharacter[p] = getRandomOrderItem(p, randomIndex);
            });
            render(elements.characterDisplay, state.idleCharacter);
            state.idleInterval = setInterval(() => {
                const p = state.parts[Math.floor(Math.random() * state.parts.length)];
                let next;
                do { 
                    const randomIndex = Math.floor(Math.random() * state.partCounts[p]);
                    next = getRandomOrderItem(p, randomIndex); 
                } while (next.id === state.idleCharacter[p].id); // –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Å–ª–µ–¥—É—é—â–∞—è —á–∞—Å—Ç—å –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç —Ç–µ–∫—É—â–µ–π
                state.idleCharacter[p] = next;
                render(elements.characterDisplay, state.idleCharacter);
            }, 1000);
        }

        // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –≤ —Ä–µ–∂–∏–º–µ –æ–∂–∏–¥–∞–Ω–∏—è
        function stopIdle() { 
            if (state.idleInterval) {
                clearInterval(state.idleInterval);
                state.idleInterval = null;
            }
        }

        // –ê–Ω–∏–º–∞—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –∫–Ω–æ–ø–∫–∏
        function hideButtonWithAnimation(button) {
            button.style.transition = 'all 0.2s ease';
            button.style.opacity = '0';
            button.style.transform = 'scale(0.8)';
            setTimeout(() => {
                button.classList.add('hidden');
                button.style.transition = '';
                button.style.opacity = '';
                button.style.transform = '';
            }, 200);
        }

        // –ù–∞—á–∞–ª–æ –∏–≥—Ä—ã
        function startGame() {
            // –ü—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"
            if (state.startBtnLock) {
                return;
            }
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Å—Ä–∞–∑—É –∂–µ
            state.startBtnLock = true;
            elements.startBtn.disabled = true;
            elements.startBtn.style.pointerEvents = 'none';
            elements.startBtn.style.cursor = 'not-allowed';
            elements.startBtn.style.opacity = '0.7';
            
            state.isBusy = true;
            state.gamePhase = 'creating';
            
            stopIdle();
            
            // –ú–µ–Ω—è–µ–º –Ω–∞–¥–ø–∏—Å—å –Ω–∞ "–°–æ–∑–¥–∞—ë–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞..."
            elements.instruction.classList.remove('show');
            setTimeout(() => {
                elements.instruction.textContent = "–°–æ–∑–¥–∞—ë–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞...";
                elements.instruction.classList.add('show');
            }, 400);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –∫–Ω–æ–ø–∫–∏ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"
            hideButtonWithAnimation(elements.startBtn);
            
            let duration = 0;
            // –ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ —á–∞—Å—Ç–µ–π –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ (2 —Å–µ–∫—É–Ω–¥—ã)
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            if (state.fastCycle) {
                clearInterval(state.fastCycle);
                state.fastCycle = null;
            }
            
            state.fastCycle = setInterval(() => {
                const temp = {};
                state.parts.forEach(p => {
                    const randomIndex = Math.floor(Math.random() * state.partCounts[p]);
                    temp[p] = getRandomOrderItem(p, randomIndex);
                });
                render(elements.characterDisplay, temp);
                duration += 100;
                if (duration >= 2000) {
                    clearInterval(state.fastCycle);
                    state.fastCycle = null;
                    finalizeTarget(); // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–µ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
                }
            }, 100);
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–µ—Ä–∏–∏
        function getMemorizeTime() {
            if (state.streak >= 50) return 1;      // 50+ —Å–µ—Ä–∏—è = 1 —Å–µ–∫—É–Ω–¥–∞
            else if (state.streak >= 30) return 2; // 30-49 —Å–µ—Ä–∏—è = 2 —Å–µ–∫—É–Ω–¥—ã
            else if (state.streak >= 15) return 3; // 15-29 —Å–µ—Ä–∏—è = 3 —Å–µ–∫—É–Ω–¥—ã
            else if (state.streak >= 5) return 4;  // 5-14 —Å–µ—Ä–∏—è = 4 —Å–µ–∫—É–Ω–¥—ã
            else return 5;                         // 0-4 —Å–µ—Ä–∏—è = 5 —Å–µ–∫—É–Ω–¥
        }

        // –§–∏–∫—Å–∞—Ü–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –∏ –Ω–∞—á–∞–ª–æ —Ñ–∞–∑—ã –∑–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
        function finalizeTarget() {
            state.gamePhase = 'memorizing';
            
            state.parts.forEach(p => {
                const randomIndex = Math.floor(Math.random() * state.partCounts[p]);
                state.target[p] = getRandomOrderItem(p, randomIndex);
            });
            render(elements.characterDisplay, state.target);
            
            // –ú–µ–Ω—è–µ–º –Ω–∞–¥–ø–∏—Å—å –Ω–∞ "–ó–∞–ø–æ–º–Ω–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞"
            setTimeout(() => {
                elements.instruction.classList.remove('show');
                setTimeout(() => {
                    elements.instruction.textContent = "–ó–∞–ø–æ–º–Ω–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞";
                    elements.instruction.classList.add('show');
                    
                    let timeLeft = getMemorizeTime(); // –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è
                    elements.timer.textContent = timeLeft;
                    elements.timer.classList.add('show');
                    state.isTimerActive = true;
                    
                    const t = setInterval(() => {
                        timeLeft--;
                        elements.timer.textContent = timeLeft;
                        
                        if (timeLeft <= 0) {
                            clearInterval(t);
                            state.isTimerActive = false;
                            setTimeout(() => {
                                elements.timer.classList.remove('show');
                                startSelecting();
                            }, 300);
                        }
                    }, 1000);
                }, 400);
            }, 500);
        }

        // –ù–∞—á–∞–ª–æ —Ñ–∞–∑—ã –≤—ã–±–æ—Ä–∞ –∏–≥—Ä–æ–∫–∞
        function startSelecting() {
      
            // –î–∞–µ–º –Ω–∞–¥–ø–∏—Å–∏ "–ó–∞–ø–æ–º–Ω–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞" –ø–æ–ª–Ω–æ—Å—Ç—å—é –∏—Å—á–µ–∑–Ω—É—Ç—å
            elements.instruction.classList.remove('show');
            
            // –ñ–¥–µ–º –Ω–µ–º–Ω–æ–≥–æ —á—Ç–æ–±—ã –Ω–∞–¥–ø–∏—Å—å "–ó–∞–ø–æ–º–Ω–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞" —É—Å–ø–µ–ª–∞ –∏—Å—á–µ–∑–Ω—É—Ç—å
            setTimeout(() => {
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É "–í—ã–±—Ä–∞—Ç—å" —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π
                elements.selectBtn.classList.remove('hidden');
                elements.selectBtn.classList.add('show');
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Ü–∏–∫–ª—É –≤—ã–±–æ—Ä–∞
                nextCycle();
            }, 400);
            // –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞
            if (state.gamePhase === 'selecting') {
                return;
            }
            
            state.gamePhase = 'selecting';
            state.currentPart = 0;
            state.selection = {};
            state.canSelect = true; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤—ã–±–æ—Ä–∞

            state.isBusy = false;
        }

        // –¶–∏–∫–ª –≤—ã–±–æ—Ä–∞ —Ç–µ–∫—É—â–µ–π —á–∞—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        function nextCycle() {
            if (state.currentPart >= state.parts.length) { finish(); return; }
            
            const type = state.parts[state.currentPart];
            
            // –î–ª—è –ö–û–ñ–ò —á–∞—Å—Ç—å —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –≤ startSelecting(), –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö - –¥–æ–±–∞–≤–ª—è–µ–º –∑–¥–µ—Å—å
            if (state.currentPart > 0) {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–π —á–∞—Å—Ç–∏
                state.selection[type] = getRandomOrderItem(type, 0);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞–¥–ø–∏—Å—å
            elements.instruction.classList.remove('show');
            setTimeout(() => {
                elements.instruction.textContent = `–í—ã–±–µ—Ä–∏ ${getLabel(type)}`;
                elements.instruction.classList.add('show');
            }, 200);
            
            // –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ —Å —É—á–µ—Ç–æ–º —Å–µ—Ä–∏–∏ –ø–æ–±–µ–¥
            let baseSpeed = 1200 - (state.currentPart * 200);
            let finalSpeed = state.streak > 0 ? baseSpeed * Math.pow(0.95, state.streak) : baseSpeed;
            finalSpeed = Math.max(finalSpeed, 200);
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª–∏—á–µ—Å–∫—É—é —Å–º–µ–Ω—É –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–µ–∫—É—â–µ–π —á–∞—Å—Ç–∏
            let idx = 0;
            
            // –û—á–∏—â–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∏–Ω—Ç–µ—Ä–≤–∞–ª, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
            if (state.interval) {
                clearInterval(state.interval);
                state.interval = null;
            }
            
            // –ù–ï–ú–ï–î–õ–ï–ù–ù–û –∑–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—ã–π —Ç–∏–∫ –≤–º–µ—Å—Ç–æ –æ–∂–∏–¥–∞–Ω–∏—è –ø–µ—Ä–≤–æ–π –∑–∞–¥–µ—Ä–∂–∫–∏
            const cycle = () => {
                idx = (idx + 1) % state.partCounts[type];
                state.selection[type] = getRandomOrderItem(type, idx);
                render(elements.characterDisplay, state.selection);
            };
            
            // –û–°–û–ë–´–ô –°–õ–£–ß–ê–ô –î–õ–Ø –ö–û–ñ–ò: –Ω–∞—á–∏–Ω–∞–µ–º —Å –∏–Ω–¥–µ–∫—Å–∞ -1
            if (state.currentPart === 0) {
                // –î–ª—è –∫–æ–∂–∏ –Ω–∞—á–∏–Ω–∞–µ–º —Å –∏–Ω–¥–µ–∫—Å–∞ -1, —á—Ç–æ–±—ã –ø–µ—Ä–≤–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ cycle() –¥–∞–ª–æ –∏–Ω–¥–µ–∫—Å 0
                idx = -1;
            }
            
            // –ó–∞–ø—É—Å–∫–∞–µ–º –ø–µ—Ä–≤—ã–π —Ü–∏–∫–ª —Å—Ä–∞–∑—É
            cycle();
            
            // –ó–∞—Ç–µ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Ü–∏–∫–ª–æ–≤
            state.interval = setInterval(cycle, finalSpeed);
        }

        // –ü–æ–ª—É—á–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è —á–∞—Å—Ç–∏ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
        function getLabel(t) { return {skin:'—Ü–≤–µ—Ç –∫–æ–∂–∏', head:'–≥–æ–ª–æ–≤—É', body:'—Ç–µ–ª–æ', accessory:'–∞–∫—Å–µ—Å—Å—É–∞—Ä'}[t]; }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∏–≥—Ä–æ–∫–∞ - –û–ë–©–ê–Ø –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ö–ù–û–ü–ö–ò –ò –ü–†–û–ë–ï–õ–ê
        function select() {
            if (!state.canSelect) {
                return false;
            }
            if (state.gamePhase !== 'selecting') {
                return false;
            }
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ
            state.canSelect = false;
            
            // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª —Ü–∏–∫–ª–∞
            if (state.interval) {
                clearInterval(state.interval);
                state.interval = null;
            }
            
            // –§–∏–∫—Å–∏—Ä—É–µ–º —Ç–µ–∫—É—â—É—é –≤—ã–±—Ä–∞–Ω–Ω—É—é —á–∞—Å—Ç—å
            const currentType = state.parts[state.currentPart];
            
            state.currentPart++;
            
            if (state.currentPart >= state.parts.length) {
                hideButtonWithAnimation(elements.selectBtn);
                setTimeout(() => {
                    state.canSelect = true;
                    finish();
                }, 200);
            } else {
                // –î–æ–±–∞–≤–ª—è–µ–º –Ω–µ–±–æ–ª—å—à—É—é –ø–∞—É–∑—É –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Å–ª–µ–¥—É—é—â–µ–π —á–∞—Å—Ç–∏
                setTimeout(() => { 
                    state.canSelect = true; // –í–û–°–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –í–û–ó–ú–û–ñ–ù–û–°–¢–¨ –í–´–ë–û–†–ê
                    nextCycle(); 
                }, 150);
            }
            
            return true;
        }

        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∏–≥—Ä—ã –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
        function finish() {
            state.gamePhase = 'finished';
            state.isBusy = true;
            elements.instruction.classList.remove('show');
            
            // –û—á–∏—â–∞–µ–º –∏–Ω—Ç–µ—Ä–≤–∞–ª, –µ—Å–ª–∏ –æ–Ω –µ—â–µ –∞–∫—Ç–∏–≤–µ–Ω
            if (state.interval) {
                clearInterval(state.interval);
                state.interval = null;
            }
            
            // –°–Ω–∞—á–∞–ª–∞ —Å–∫—Ä—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤—É—é –æ–±–ª–∞—Å—Ç—å (0.4—Å)
            elements.gameArea.classList.add('hidden');
            
            // –ß–µ—Ä–µ–∑ 0.4—Å –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (0.4—Å)
            setTimeout(() => {
                // –ü–æ–¥—Å—á—ë—Ç —Å–æ–≤–ø–∞–¥–µ–Ω–∏–π
                let m = 0;
                state.parts.forEach(p => { if(state.selection[p].id === state.target[p].id) m++; });
                const p = Math.round((m/4)*100);
                
                // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–∏–µ–π –ø–æ–±–µ–¥ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                if (p === 100) {
                    // 100% - —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å–µ—Ä–∏—é
                    state.streak++; 
                    state.lastResult = 'win'; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ –ø–æ–±–µ–¥—É
                } else if (p < 75) {
                    // –ú–µ–Ω—å—à–µ 75% - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–µ—Ä–∏—é
                    state.streak = 0; 
                    state.lastResult = 'lose'; // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ –ø–æ—Ä–∞–∂–µ–Ω–∏–µ
                } else {
                    // 75% –∏ –±–æ–ª—å—à–µ (–Ω–æ –Ω–µ 100%) - –æ—Å—Ç–∞–≤–ª—è–µ–º —Å–µ—Ä–∏—é –∫–∞–∫ –µ—Å—Ç—å
                    // state.streak –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
                    state.lastResult = 'almost'; // –ù–æ–≤—ã–π —Ç–∏–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å–µ—Ä–∏–∏
                if (state.streak > state.maxStreak) {
                    state.maxStreak = state.streak;
                }
                
                elements.resultPercent.textContent = p + '%';
                elements.resultText.textContent = p === 100 ? "–ò–¥–µ–∞–ª—å–Ω–æ! üéâ" : (p >= 75 ? "–ü–æ—á—Ç–∏! ü§èüèª" : "–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑...");
                render(elements.resultTarget, state.target);
                render(elements.resultPlayer, state.selection);
                updateStats();
                elements.resultScreen.classList.add('show'); // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                state.startBtnLock = false; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"
                state.resetBtnLock = false; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É "–ï—â—ë —Ä–∞–∑"
                state.isBusy = false; // –°–Ω–∏–º–∞–µ–º –±–ª–æ–∫–∏—Ä–æ–≤–∫—É
            }, 400); // –ó–∞–¥–µ—Ä–∂–∫–∞ = –≤—Ä–µ–º—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
        }

        // –°–±—Ä–æ—Å –∏–≥—Ä—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ä–∞—É–Ω–¥–∞
        function reset() {
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–ï—â—ë —Ä–∞–∑"
            if (state.resetBtnLock) {
                return;
            }
            
            if (state.isBusy) {
                return;
            }
            
            // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É —Å—Ä–∞–∑—É –∂–µ
            state.resetBtnLock = true;
            elements.resultAgainBtn.disabled = true;
            elements.resultAgainBtn.style.pointerEvents = 'none';
            elements.resultAgainBtn.style.cursor = 'not-allowed';
            elements.resultAgainBtn.style.opacity = '0.7';
            
            state.round++;
            
            // –°—Ä–∞–∑—É —Å–∫—Ä—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            elements.resultScreen.classList.remove('show');
            
            // –û–ß–ò–°–¢–ö–ê: —É–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
            state.target = {};
            state.selection = {};
            state.idleCharacter = {};
            
            // –û—á–∏—â–∞–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞ –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
            elements.characterDisplay.innerHTML = '';
            
            // –ñ–¥–µ–º –ø–æ–∫–∞ —Å–∫—Ä–æ–µ—Ç—Å—è —ç–∫—Ä–∞–Ω —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (0.4—Å) –∏ –¢–û–õ–¨–ö–û –ü–û–¢–û–ú –æ—á–∏—â–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
            setTimeout(() => {
                // –û—á–∏—â–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π –Ω–∞ —ç–∫—Ä–∞–Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ü–û–°–õ–ï –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–∫—Ä—ã—Ç–∏—è
                elements.resultTarget.innerHTML = '';
                elements.resultPlayer.innerHTML = '';
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ (–≤–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É")
                elements.startBtn.classList.remove('hidden');
                elements.startBtn.style.opacity = '1';
                elements.startBtn.style.transform = 'scale(1)';
                elements.startBtn.disabled = false;
                elements.startBtn.style.pointerEvents = 'auto';
                elements.startBtn.style.cursor = 'pointer';
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏ "–ï—â—ë —Ä–∞–∑"
                elements.resultAgainBtn.disabled = false;
                elements.resultAgainBtn.style.pointerEvents = 'auto';
                elements.resultAgainBtn.style.cursor = 'pointer';
                elements.resultAgainBtn.style.opacity = '1';
                
                elements.selectBtn.classList.remove('show');
                elements.selectBtn.classList.add('hidden');
                elements.selectBtn.style.opacity = '';
                elements.selectBtn.style.transform = '';
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä–æ–≤—É—é –æ–±–ª–∞—Å—Ç—å —Å –Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞–¥–ø–∏—Å—å—é
                elements.gameArea.classList.remove('hidden');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updateStats();
                
                // –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –≤ —Ä–µ–∂–∏–º –æ–∂–∏–¥–∞–Ω–∏—è
                setTimeout(() => {
                    startIdle();
                }, 100);
            }, 400); // –ó–∞–¥–µ—Ä–∂–∫–∞ = –≤—Ä–µ–º—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
        function updateStats() {
            const anim = (el, val) => {
                if (el.textContent != val) {
                    el.classList.add('updating');
                    setTimeout(() => { el.textContent = val; el.classList.remove('updating'); }, 300);
                }
            };
            anim(elements.round, state.round);
            anim(elements.streak, state.streak);
            anim(elements.maxStreak, state.maxStreak);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è –ø—Ä–æ–±–µ–ª–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –£–ü–†–û–©–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø
        window.addEventListener('keydown', e => {
            if (e.code === 'Space') {
                e.preventDefault();

                // –ó–∞–ø—Ä–µ—â–∞–µ–º –Ω–∞–∂–∞—Ç–∏–µ –ø—Ä–æ–±–µ–ª–∞ –≤ —Å–ª–µ–¥—É—é—â–∏–µ –º–æ–º–µ–Ω—Ç—ã:
                if (state.isTimerActive) return;
                if (state.isBusy) return;
                if (state.gamePhase === 'memorizing') return;
                if (state.gamePhase === 'creating') return;
                // –ï—Å–ª–∏ —Ñ–∞–∑–∞ –≤—ã–±–æ—Ä–∞, –Ω–æ –∫–Ω–æ–ø–∫–∞ "–í—ã–±—Ä–∞—Ç—å" –µ—â–µ —Å–∫—Ä—ã—Ç–∞ - –Ω–µ –ø–æ–∑–≤–æ–ª—è–µ–º
                if (state.gamePhase === 'selecting' && elements.selectBtn.classList.contains('hidden')) {
                    return;
                }
                
                // –†–∞–∑—Ä–µ—à–∞–µ–º –¥–µ–π—Å—Ç–≤–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã
                if (state.gamePhase === 'idle' && !state.startBtnLock && !elements.startBtn.classList.contains('hidden')) {
                    startGame();
                } else if (state.gamePhase === 'selecting' && state.canSelect) {
                    select();
                } else if (state.gamePhase === 'finished' && !state.resetBtnLock) {
                    reset();
                }
            }
        });

        // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫
        elements.startBtn.onclick = function() {
            startGame();
        };
        
        elements.selectBtn.onclick = function() {
            select();
        };
        
        elements.resultAgainBtn.onclick = function() {
            reset();
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = async () => {
            await loadImages();
            startIdle();
        };
    </script>
</body>
</html>
